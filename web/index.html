<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="theme-color" content="#05070C">
  <link rel="manifest" href="/pwa/manifest.json">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Rajdhani:wght@500;700&family=Oxanium:wght@500;700&family=Inter:wght@400;600&family=JetBrains+Mono:wght@400;600&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/web/app.css">
  <title>SWARMZ // CONTROL — Operator-Sovereign System</title>
</head>
<body>

<!-- scanline overlay -->
<div class="scanlines" aria-hidden="true"></div>

<div id="coreFrame">

  <!-- TOP BAR -->
  <header id="topBar">
    <div class="top-left">
      <h1 class="logo">SWARMZ CONTROL</h1>
      <div class="tagline">Operator-Sovereign mission console</div>
    </div>
    <div class="top-right">
      <span class="chip" id="chipRuntime">RUNTIME --</span>
      <span class="chip" id="chipState">STATE --</span>
      <span class="chip" id="chipAi">AI --</span>
      <span class="chip chip-dim" id="chipLan">LAN --</span>
      <span class="chip" id="chipLock">LOCKED</span>
      <span class="chip chip-dim" id="chipView">VIEW CLOSE</span>
    </div>
  </header>

  <!-- ERROR BANNER -->
  <div id="errorBanner" class="error-banner hidden"></div>

  <!-- QUARANTINE BANNER -->
  <div id="quarantineBanner" class="quarantine-banner hidden">QUARANTINE ACTIVE — mission execution blocked (success rate &lt; 30%)</div>

  <!-- MODE TABS -->
  <div class="mode-tabs">
    <button class="mode-tab active" id="tabCompanion" data-mode="COMPANION">COMPANION</button>
    <button class="mode-tab" id="tabBuild" data-mode="BUILD">BUILD</button>
    <button class="mode-tab" id="tabHologram" data-mode="HOLOGRAM">HOLOGRAM</button>
  </div>

  <!-- MAIN AREA -->
  <main id="mainArea">

    <!-- LEFT: Action Panel -->
    <section class="panel panel-action">
      <h2 class="panel-title" id="panelTitle">DISPATCH</h2>

      <label class="field-label">OPERATOR KEY</label>
      <input type="password" id="opKeyInput" placeholder="ENTER KEY" autocomplete="off">

      <label class="field-label">GOAL (LOCAL)</label>
      <input type="text" id="goalInput" placeholder="e.g. ship feature X, learn Y" autocomplete="off">

      <!-- COMPANION view -->
      <div id="companionView">
        <label class="field-label">MESSAGE</label>
        <input type="text" id="companionInput" placeholder="Ask the swarm...">
        <div class="btn-row">
          <button class="btn btn-primary" id="btnSend">SEND</button>
        </div>
        <div class="companion-reply panel-inner" id="companionReply"></div>
      </div>

      <!-- BUILD view -->
      <div id="buildView" class="hidden">
        <label class="field-label">INTENT</label>
        <input type="text" id="intentInput" placeholder="smoke / test_mission / ...">

        <label class="field-label">SPEC (JSON)</label>
        <input type="text" id="specInput" placeholder='{"key":"value"}'>

        <div class="btn-row">
          <button class="btn btn-primary" id="btnDispatch">DISPATCH</button>
          <button class="btn btn-ghost" id="btnCommit">COMMIT</button>
        </div>
      </div>

      <!-- HOLOGRAM view -->
      <div id="hologramView" class="hidden">
        <div class="companion-reply panel-inner" id="hologramEmbed">
          <div class="empty-msg">HOLOGRAM VISUAL</div>
          <iframe id="hologramFrame" src="" style="width:100%;height:300px;border:none;border-radius:8px;display:none;background:var(--void);"></iframe>
        </div>
        <div class="btn-row">
          <a class="btn btn-ghost" href="/hologram" target="_blank">OPEN FULL HOLOGRAM</a>
        </div>
      </div>

      <div class="hint" id="actionHint"></div>
    </section>

    <!-- RIGHT: Data Panel -->
    <section class="panel panel-data">
      <!-- ACTIVE mission -->
      <h2 class="panel-title">ACTIVE</h2>
      <div class="current-mission" id="currentMission"></div>

      <!-- METRICS -->
      <h2 class="panel-title mt-12">METRICS</h2>
      <div class="stat-row">
        <div class="stat-block">
          <div class="stat-value" id="statTotal">0</div>
          <div class="stat-label">TOTAL</div>
        </div>
        <div class="stat-block">
          <div class="stat-value" id="statPending">0</div>
          <div class="stat-label">PENDING</div>
        </div>
        <div class="stat-block">
          <div class="stat-value" id="statSuccess">0</div>
          <div class="stat-label">SUCCESS</div>
        </div>
        <div class="stat-block">
          <div class="stat-value" id="statRunning">0</div>
          <div class="stat-label">RUNNING</div>
        </div>
      </div>

      <h2 class="panel-title mt-12">Prime State</h2>
      <div id="prime-state-panel" class="mission-list">
        <pre id="prime-state-json">Loading...</pre>
      </div>

      <!-- GUIDANCE: context-aware suggestions for the operator -->
      <h2 class="panel-title mt-12">GUIDANCE</h2>
      <div class="mission-list" id="guidancePanel">
        <div class="empty-msg" id="guidanceSummary">Waiting for state...</div>
      </div>

      <!-- QUEUE -->
      <h2 class="panel-title mt-12">QUEUE</h2>
      <div class="mission-list" id="missionList">
        <div class="empty-msg">NO MISSIONS YET</div>
      </div>

      <!-- INFRA OVERVIEW (optional, gated by backend flag) -->
      <h2 class="panel-title mt-12">INFRA</h2>
      <div class="mission-list" id="infraPanel">
        <div class="empty-msg" id="infraSummary">INFRA: DISABLED</div>
        <div class="empty-msg" id="infraAutoscale">AUTOSCALE: --</div>
        <div class="empty-msg" id="infraBackup">BACKUP: --</div>
        <div class="btn-row mt-8">
          <button class="btn btn-tiny" id="btnInfraSim">RUN INFRA SIM</button>
        </div>
      </div>

      <!-- NETWORK OVERVIEW (derived from infra, if present) -->
      <h2 class="panel-title mt-12">NETWORK</h2>
      <div class="mission-list" id="networkPanel">
        <div class="empty-msg" id="networkSummary">NETWORK: --</div>
      </div>
    </section>

  </main>

  <!-- BOTTOM STRIP: SYSTEM LOG -->
  <footer class="panel panel-log">
    <div class="log-header">
      <h2 class="panel-title">SYSTEM LOG</h2>
      <div class="log-actions">
        <button class="btn btn-tiny" id="btnSync">SYNC</button>
        <button class="btn btn-tiny btn-warn" id="btnResetShell">RESET SHELL</button>
      </div>
    </div>
    <div class="log-feed" id="logFeed">Waiting for events...</div>
  </footer>

</div><!-- /coreFrame -->

<script src="/web/app.js"></script>
<script>
async function loadPrimeState() {
  try {
    const res = await fetch("/v1/operator-os/prime-state");
    if (!res.ok) throw new Error("Failed to load prime state");
    const data = await res.json();
    document.getElementById("prime-state-json").textContent =
      JSON.stringify(data, null, 2);
  } catch (e) {
    document.getElementById("prime-state-json").textContent =
      "Error loading prime state: " + e.message;
  }
}

window.addEventListener("load", loadPrimeState);
</script>
</body>
</html>
